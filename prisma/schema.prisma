// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model Transaction {
  id      Int      @id @default(autoincrement())
  hash    String   @unique
  block   Int?
  post    Post?    @relation(name: "Transactions")
  message Message? @relation(name: "Transactions")
  lock    Lock?    @relation(name: "Transactions")
  locks   Lock[]   @relation(name: "LockTo")
}

model User {
  id       Int       @id @default(autoincrement())
  address  String    @unique
  posts    Post[]    @relation(name: "Posts")
  messages Message[] @relation(name: "Messages")
  locks    Lock[]    @relation(name: "Locks")
}

model Post {
  id                  Int          @id @default(autoincrement())
  txid                String       @unique
  transaction         Transaction? @relation(name: "Transactions", fields: [txid], references: [hash])
  createdAt           DateTime     @default(now())
  content             String
  contentType         String
  inReplyTo           String?
  postedBy            User?        @relation(name: "Posts", fields: [postedByUserAddress], references: [address])
  postedByUserAddress String?
  app                 String
}

model Message {
  id                Int          @id @default(autoincrement())
  txid              String       @unique
  transaction       Transaction? @relation(name: "Transactions", fields: [txid], references: [hash])
  createdAt         DateTime     @default(now())
  channel           String       @unique
  content           String
  contentType       String
  inReplyTo         String
  app               String
  sentBy            User?        @relation(name: "Messages", fields: [sentByUserAddress], references: [address])
  sentByUserAddress String?
}

model Lock {
  id                  Int          @id @default(autoincrement())
  txid                String?      @unique
  transaction         Transaction? @relation(name: "Transactions", fields: [txid], references: [hash])
  createdAt           DateTime     @default(now())
  satoshis            BigInt
  blockHeight         Int
  lockTarget          Transaction? @relation(name: "LockTo", fields: [lockTargetByTxid], references: [hash]) // Can be Post or Message
  lockTargetByTxid    String?
  locker              User?        @relation(name: "Locks", fields: [lockerByUserAddress], references: [address])
  lockerByUserAddress String?
}
